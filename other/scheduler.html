<!--
---
permalink: /other/scheduler
---
-->

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" media="screen and (min-width: 901px)" href="../CSS/desktop.css" />
    <link rel="stylesheet" media="screen and (max-width: 900px)" href="../CSS/mobile.css" />
    
    <link rel="stylesheet" href="../CSS/style.css">

    <style>
        input.HourBox {width: 24pt;}
        input.MinuteBox {width: 24pt;}

        div.border {color: #78CCAD; border-style: solid; border-width: 1pt; border-radius: 6pt;}

        p {white-space: nowrap;}
        h3 {white-space: nowrap;}

        input.act[type=button] {background-color: lightgray; stroke: none; padding: 10pt 10pt; 
            margin-left: auto; margin-right: auto; font-size: 15pt; color: #505050; 
            font-family: 'Calibri', 'Candara', 'Segoe', "Segoe UI";}

        .inline {display: inline-block;}
    </style>

</head>

<body>


<table id="MainTable">
    
    <tr id="MobileTitleRow">
        <td></td>

        <td id="MobileTitlecolumn">
            <a class="TitleLink" href="https://www.dylancarroll.net">Dylan Carroll</a>
        </td>
    </tr>
    <tr id = "MobileTitleDiv"></tr>


    <tr id="TopBarRow">
        
        <td id="DesktopTitleColumn">
            <a class="TitleLink" href="https://www.dylancarroll.net">Dylan Carroll</a>
        </td>
        <td id="TitleDivColumn" > <div id="TitleDiv"></div> </td>
        
        
        <td>
            <table id="NavTable">
                <tr>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/about">About</a></td>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/animation">Animation</a></td>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/programming">Programming</a></td>
                </tr>
                <tr>
                    
                    <td><a class="NavLink" href="https://www.dylancarroll.net/contact">Contact</a></td>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/other">other</a></td>
                </tr>
            </table>

        </td>
    </tr>
    
    <tr><td id = "ContentPad"></td></tr>

    <tr id="BodyRow"> 
        <table id="BodyTable"><tr>
            <td id="BodyEdge"></td>

            <td>
                <div id="BodyDiv">

                    <div class="border settings" >
                        <table style="margin-left: auto; margin-right: auto; line-height: 0pt; border-spacing: 12pt 0pt;"> 
                        <tbody id="settingsTbody">
                            <tr>
                                <td> <h3 style="line-height: 0pt;"> Settings </td>
                            </tr>

                            <tr>
                                <td > <p>Start Time: </p> </td>
                                <td> <input class=StartTime type="time">  </td>
                                    
                                
                                
                                <td> <p>End Time: </p> </td>
                                <td> <input class=EndTime type="time" >  </td>
                            </tr>
                            
                            <tr>
                                <td> <p>Min Courses</p> </td>
                                <td> <input type="number" min=0 value=0 style="width: 48pt"> </td>


                                <td> <p>Max Courses</p> </td>
                                <td> <input type="number" min=0 style="width: 48pt"> </td>

                                    
                            </tr>
                            
                            <tr>
                                <td> <p>Min Credits</p> </td>
                                <td> <input type="number" min=0 value=0 style="width: 48pt"> </td>
                                    
                                
                                
                                <td> <p>Max Credits</p> </td>
                                <td> <input type="number" min=0 style="width: 48pt"> </td>
                                
                                
                            </tr>
                        </tbody>
                        </table>

                        <div align=center>
                            <input class="inline" type="file" id="saveFile" name="saveFile" onchange="fileSelected()">
                            <input type=button value="Download Save" onclick="downloadSave()">

                        </div>
                        &nbsp;

                    </div>

                    &nbsp;

                    <table  style="width: 100%;">
                        <tbody id="CourseTableBody">
                        <tr><td>
                            <div class="border" style="line-height: 0pt;"> 
                                <div align="center">
                                    <h3 class="inline" style="line-height: 0pt;">Course 1</h3>

                                    <p class="inline" style="margin-left: 24pt;">Name:</p> <input type="text" style="width: 72pt;">

                                    <p class="inline" style="margin-left: 24pt;">CRN:</p> <input type="number" style="width: 60pt;">
                                </div>
                                
                                
                                <div align="center">
                                    <p class="inline">Credits:</p> <input type="number" min="0" style="width: 36pt;">
                                
                                    <p class="inline" style="margin-left: 24pt;">Shade:</p>
                                    <select>
                                        <option value="0">Medium</option>
                                        <option value ="1">Dark</option>
                                        <option value="2">Light</option>
                                    </select>

                                    <p class="inline" style="margin-left: 24pt;">Color:</p>
                                    <select>
                                        <option value="0">Red</option>
                                        <option value="1">Orange</option>
                                        <option value="2">Yellow</option>
                                        <option value="3">Green</option>
                                        <option value="4">Teal</option>
                                        <option value="5">Blue</option>
                                        <option value="6">Purple</option>
                                        <option value="7">Grey</option>
                                    </select>
                                </div>

                                <div>
                                    <div align="center">
                                        <p class="inline">Start:</p> <input type="time">

                                        <p class="inline" style="margin-left: 12pt;">End:</p> <input type="time">

                                        <input type="text" value="MTWRF" style="width: 40pt; margin-left: 6pt;">
                                    </div>

                                    <div align="center">
                                        <input type="button" value="Add Time Slot" onclick= "addTimeSlot(this)" style="margin-left: 6pt;">
                                        <input type="button" value="Remove Time Slot" onclick= "removeTimeSlot(this)" style="margin-left: 6pt;"> 
                                    </div>

                                    
                                </div>

                                <div align="center">
                                    <p class="inline">Group:</p> <input type="text" style="width: 36pt;">
                                    <p class="inline" style="margin-left: 12pt;">Note:</p> <input class="inline" type="text" style="width: 175pt; margin-left: 12pt;">
                                </div>
                            </div>
                        </td></tr>

                        
                        </tbody>
                    </table>
                    

                    &nbsp;
                    <div align=center style="margin-left: auto; margin-right: auto; display: block;">
                        <input class="act" type="button" onclick="removeCourse()" value="Remove Course">
                        <input class="act" type="button" onclick="addCourse()" value="Add Course">
                    </div>
                    
                    &nbsp;

                    <div id = "DisplayDiv">
                        <div align=center style="margin-left: auto; margin-right: auto; display: block;">
                            <input class="act" type="button" onclick="calcOptions()" value="Calculate Options">
                            <input class="act" type="button" onclick="downloadImages()" value="Download Images">
                        </div>

                        <canvas id="MainCanvas" style="width: 100%; height: 100px; color: #505050 1pt;">

                        </canvas>

                        <div align=center style="margin-left: auto; margin-right: auto; display: block;">
                            <input class="act" type="button" onclick="showPrev()" value="Show Previous">
                            <input class="act" type="button" onclick="showNext()" value="Show Next">
                        </div>


                    </div>

                </div>
            </td>


            <td id="BodyEdge"></td>
        </tr></table>
    </tr>

</table>

</body>

<script>
    var blankCourseElement = `<tr><td>
                            <div class="border" style="line-height: 0pt;"> 
                                <div align="center">
                                    <h3 class="inline" style="line-height: 0pt;">{Course}</h3>

                                    <p class="inline" style="margin-left: 24pt;">Name:</p> <input type="text" style="width: 72pt;">

                                    <p class="inline" style="margin-left: 24pt;">CRN:</p> <input type="number" style="width: 60pt;">
                                </div>
                                
                                
                                <div align="center">
                                    <p class="inline">Credits:</p> <input type="number" min="0" style="width: 36pt;">
                                
                                    <p class="inline" style="margin-left: 24pt;">Shade:</p>
                                    <select>
                                        <option value="0">Medium</option>
                                        <option value ="1">Dark</option>
                                        <option value="2">Light</option>
                                    </select>

                                    <p class="inline" style="margin-left: 24pt;">Color:</p>
                                    <select>
                                        <option value="0">Red</option>
                                        <option value="1">Orange</option>
                                        <option value="2">Yellow</option>
                                        <option value="3">Green</option>
                                        <option value="4">Teal</option>
                                        <option value="5">Blue</option>
                                        <option value="6">Purple</option>
                                        <option value="7">Grey</option>
                                    </select>
                                </div>

                                <div>
                                    <div align="center">
                                        <p class="inline">Start:</p> <input type="time">

                                        <p class="inline" style="margin-left: 12pt;">End:</p> <input type="time">

                                        <input type="text" value="MTWRF" style="width: 40pt; margin-left: 6pt;">
                                    </div>

                                    <div align="center">
                                        <input type="button" value="Add Time Slot" onclick= "addTimeSlot(this)" style="margin-left: 6pt;">
                                        <input type="button" value="Remove Time Slot" onclick= "removeTimeSlot(this)" style="margin-left: 6pt;"> 
                                    </div>

                                    
                                </div>

                                <div align="center">
                                    <p class="inline">Group:</p> <input type="text" style="width: 36pt;">
                                    <p class="inline" style="margin-left: 12pt;">Note:</p> <input class="inline" type="text" style="width: 175pt; margin-left: 12pt;">
                                </div>
                            </div>
                        </td></tr>`;

    var blankTimeSlot = `<div align="center">
                            <p class="inline">Start:</p> <input type="time">

                            <p class="inline" style="margin-left: 12pt;">End:</p> <input type="time">

                            <input type="text" value="MTWRF" style="width: 40pt; margin-left: 6pt;">
                        </div>`

    var courseCount = 1;
                    

    var startTime = 0;
    var endTime = 0; 
    var minCredits = 0;
    var maxCredits = 0;
    var minCourses = 0;
    var maxCourses = 0;


    var currentOptionViewed = undefined;
    var allSchedules = undefined;

    class Course{
        constructor(name, crn, group, credits, starts, ends, days,  color, shade, notes){
            this.name = name; 
            this.crn = crn; 
            this.group = group; 
            this.credits = credits; 
            this.starts = starts; 
            this.ends = ends; 
            this.days = days;
            this.shade = shade;
            this.color = color;
            this.notes = notes;
        }

        //Checks if two courses' time slots overlap 0r 
        collides(other){
            if(this.group === other.group){
                return false;
            }

            for(let i = 0; i < this.starts.length; i++){
                for(let j = 0; i < other.starts.length; j++){
                    if(daysOverlap(this.days[i], other.days[j]) ){
                        //If the two courses overlap
                        if((this.start[i] >= other.start[j] && this.start[i] <= other.end[j]) 
                        || (other.start[j] >= this.start[i] && other.start[j] <= this.end[i])){
                            return false;
                        }
                    }
                }
            }

            return true;
        }

        copy(){
            return new Course(this.name, this.crn, this.group, this.credits, [...this.starts], [...this.ends], this.days, this.color, this.notes);
        }

    }

    //////////////////////
    // Button Functions //
    //////////////////////

    function fileSelected(){
        var file = document.getElementById("saveFile").files[0];
        var text = file.text();
        text.then(function(text) { populateFields(text) })
    }


    function downloadSave(){
        if(! updateSettings()){
            return null;
        }
        
        var courses = getCourseDatas();
        if(courses === null){
            return null;
        } 

        saveString = ""

        saveString += startTime + "\n";
        saveString += endTime + "\n";
        saveString += minCourses + "\n";
        saveString += maxCourses + "\n";
        saveString += minCredits + "\n";
        saveString += maxCredits + "\n";
        

        saveString += "--\n";

        for(let i = 0; i < courses.length; i++){
            if(i != 0) saveString += "--\n"

            var currentCourse = courses[i]

            saveString += currentCourse.name + "\n"; 
            saveString += currentCourse.crn + "\n"; 
            saveString += currentCourse.credits + "\n"; 
            saveString += currentCourse.shade + "\n";
            saveString += currentCourse.color + "\n";
            
            for(let i = 0; i < currentCourse.starts.length; i++){
                if(i!=0){saveString += "; ";}
                saveString += currentCourse.starts[i];
            }
            saveString += "\n";

            for(let i = 0; i < currentCourse.ends.length; i++){
                if(i!=0){saveString += "; ";}
                saveString += currentCourse.ends[i];
            }
            saveString += "\n";

            for(let i = 0; i < currentCourse.days.length; i++){
                if(i!=0){saveString += "; ";}
                saveString += currentCourse.days[i];
            }
            saveString += "\n";
            
            saveString += currentCourse.group + "\n"; 
            saveString += currentCourse.notes + "\n";
        }

        download(saveString, "save.txt", "txt")


    }
    
    function addTimeSlot(button){
        var div = button.parentElement;

        var template = document.createElement("template");
        template.innerHTML = blankTimeSlot
        var newTimeSlot = template.content.firstChild;

        div.parentElement.insertBefore(newTimeSlot, div);
    }

    function removeTimeSlot(button){
        var div = button.parentElement.parentElement;

        var children = div.children;

        if(children.length > 2){
            children[children.length-2].remove();
        }
    }

    function removeCourse(){
        if(courseCount>1){
            var courseTableBody = document.getElementById("CourseTableBody");
            var lastCourse = courseTableBody.childNodes[courseTableBody.childNodes.length - 2];

            lastCourse.remove();

            courseCount -= 1;
        }
    }

    function addCourse(){
        courseCount += 1;

        var template = document.createElement("template");
        template.innerHTML = blankCourseElement.replace("{Course}", "Course " + courseCount);
        
        var newCourseElement = template.content.firstChild;
        
        var courseTableBody = document.getElementById("CourseTableBody");
        var buttonTR = courseTableBody.childNodes[courseTableBody.childNodes.length - 1];

        courseTableBody.insertBefore(newCourseElement, buttonTR);
    }
 
    function calcOptions(){
        if(! updateSettings()){
            return null;
        }
        
        var courses = getCourseDatas();
        if(courses === null){
            return null;
        } 

        //Create a list of lists with a layer for each number of courses
        var layers = new Array();
        for(let i = 0; i < maxCourses; i++){
            layers.push(new Array());
        }

        //Populate the first layer with individual classes
        for(let i = 0; i < courses.length; i++){
            layers[0].push([courses[i].copy() ]);
        }

        for(let i = 1; i < maxCourses; i++){
            var previousList = layers[i-1]
            var currentList = layers[i];

            for(let j = 0; j < previousList.length; j++){
                //Calculate the new posibilites for the current schedule
                var newPossibilities = combinePossibilities(previousList[j], courses);

                //Add all of the newly found posibilites to the current layer
                for(let k = 0; k < newPossibilities.length; k++){
                    currentList.push(newPossibilities[k]);
                }
            }
        }

        console.log(layers)




    }

    function downloadImages(){

    }

    function showNext(){

    }

    function showPrev(){

    }


    ///////////////////
    // Program Logic //
    ///////////////////

    function populateFields(text){
        
        var courseList = text.split("--\n");


        //Update Settings Field

        var settings = courseList[0].split("\n");
   
        var settingsTbody = document.getElementById("settingsTbody");

        var row1 = settingsTbody.children[1];
        var row2 = settingsTbody.children[2];
        var row3 = settingsTbody.children[3];

        row1.children[1].children[0].value = minsToTime(parseInt(settings[0]));
        row1.children[3].children[0].value = minsToTime(parseInt(settings[1])); 
        row2.children[1].children[0].value = parseInt(settings[2]);
        row2.children[3].children[0].value = parseInt(settings[3]);
        row3.children[1].children[0].value = parseInt(settings[4]);
        row3.children[3].children[0].value = parseInt(settings[5]);

        //Get to the correct number of courses
        while(courseCount < courseList.length-1){
            addCourse();
        }
        while(courseCount > courseList.length-1){
            removeCourse();
        }
        

        //Loop through and fill in all of the courses
        var courseTableBody = document.getElementById("CourseTableBody");
        var courseTDs = courseTableBody.children;

        for(let i = 0; i < courseList.length-1; i++){
            var currentCourse = courseList[i+1].split("\n");
            
            var borderDiv = courseTDs[i].children[0].children[0];

            var div1 = borderDiv.children[0];
            var div2 = borderDiv.children[1];
            var div3 = borderDiv.children[2];
            var div4 = borderDiv.children[3];

            div1.children[2].value = currentCourse[0]; //name
            div1.children[4].value = currentCourse[1]; //crn
            div2.children[1].value = currentCourse[2]; //credits
            div2.children[3].value = currentCourse[3]; //shade
            div2.children[5].value = currentCourse[4]; //color
            
            
            var starts = currentCourse[5].split(";"); //starts
            var ends = currentCourse[6].split(";"); //ends
            var days = currentCourse[7].split(";"); //days

            //Get to the correct number of time slots
            var addButton = div3.children[div3.children.length-1].firstChild;
            while(div3.children.length-1 < starts.length){
                addTimeSlot(addButton);
            }
            while(div3.children.length-1 > starts.length){
                removeTimeSlot(addButton);
            }

            for(let i = 0; i < div3.children.length-1; i++){
                var currentDiv = div3.children[i];


                currentDiv.children[1].value = minsToTime(starts[i]); //start
                currentDiv.children[3].value = minsToTime(ends[i]); //end
                currentDiv.children[4].value = days[i]; //day
            }
            
            div4.children[1].value = currentCourse[8]; //group
            div4.children[3].value = currentCourse[9]; //notes

        }
    }

    function updateSettings(){
        var settingsTbody = document.getElementById("settingsTbody");

        var row1 = settingsTbody.children[1];
        var row2 = settingsTbody.children[2];
        var row3 = settingsTbody.children[3];

        var newStart = row1.children[1].children[0].value;
        var newEnd = row1.children[3].children[0].value;
        var newMinCourses = row2.children[1].children[0].value;
        var newMaxCourses = row2.children[3].children[0].value;
        var newMinCredits = row3.children[1].children[0].value;
        var newMaxCredits = row3.children[3].children[0].value;

        if(! validateSettings(newStart, newEnd, newMinCourses, newMaxCourses) ){
            return false;
        }
        else{
            startTime = timeToMins(newStart);
            endTime = timeToMins(newEnd);
            minCourses = parseInt(newMinCourses);
            maxCourses = parseInt(newMaxCourses);
            minCredits = parseInt(newMinCredits);
            maxCredits = parseInt(newMaxCredits);

            return true;
        }
        
    }

    function validateSettings(start, end, minCourses, maxCourses){
        if(start === ""){
            alert("Start Time can't be empty");
            return false;
        }
        else if(end === ""){
            alert("End time can't be empty");
            return false;
        }
        else if(minCourses === ""){
            alert("Min courses can't be empty");
            return false;
        }
        else if(start === ""){
            alert("Max courses can't be empty");
            return false;
        }
        else{
            return true;
        }
    }

    function validateCourseForm(course, name, crn, credits, starts, ends){
        
        for(let i = 0; i < starts.length; i++){
            
            if(starts[i] === ""){
                alert("Course " + course + " start time can't be empty");
                return false;
            }
            
            if(ends[i] === ""){
                alert("Course " + course + " end time can't be empty");
                return false;
            }
        }
        
        if(name === ""){
            alert("Course " + course + " name can't be empty");
            return false;
        }
        else if(crn === ""){
            alert("Course " + course + " CRN can't be empty");
            return false;
        }
        else if(credits === ""){
            alert("Course " + course + " credits can't be empty");
            return false;
        }
        else{
            return true;
        }

        
    }

    function getCourseDatas(){
        var courseTableBody = document.getElementById("CourseTableBody");
        var courseTDs = courseTableBody.children;

        var courses = []

        for(let i = 0; i < courseTDs.length; i++){
            var borderDiv = courseTDs[i].children[0].children[0];

            var div1 = borderDiv.children[0];
            var div2 = borderDiv.children[1];
            var div3 = borderDiv.children[2];
            var div4 = borderDiv.children[3];

            var name = div1.children[2].value;
            var crn = div1.children[4].value;
            var credits = div2.children[1].value;
            var shade = div2.children[3].value;
            var color = div2.children[5].value;
            
            
            var rawStarts = [];
            var rawEnds = [];
            var days = [];

            for(let i = 0; i < div3.children.length-1; i++){
                var currentDiv = div3.children[i];

                rawStarts.push(currentDiv.children[1].value);
                rawEnds.push(currentDiv.children[3].value);
                days.push(currentDiv.children[4].value.toLowerCase());
            }
            
            
            var group = div4.children[1].value;
            var notes = div4.children[3].value;

            if(! validateCourseForm(i+1, name, crn, credits, rawStarts, rawEnds)){
                return null;
            }

            var starts = [];
            var ends = [];

            for(let i = 0; i < rawStarts.length; i++){
                starts.push(timeToMins(rawStarts[i]));
                ends.push(timeToMins(rawEnds[i]));
            }

            var newCourse = new Course(name, crn, group, parseInt(credits), starts, ends, days, color, shade, notes);
            courses.push( newCourse );

        }

        return courses;
    }

    function timeToMins(time){
        var splitTime = time.split(":");
        var hour = splitTime[0];
        var minute = splitTime[1];
        return parseInt(hour)*60 + parseInt(minute);
    }

    function minsToTime(mins){
        var hours = Math.floor(mins/60);
        var minutes = mins - (hours*60);
        var minutesString = minutes.toString();
        if(minutesString.length ==1 )(minutesString = 0 + minutesString)
        
        var hoursString = hours.toString()
        if(hoursString.length ==1 )(hoursString = 0 + hoursString)

        return hoursString + ":" + minutesString; 
    }

    function colStrToRGB(shadeStr, colorIndStr){
        //Select the correct color from this list
        var color = [ [255, 0, 0],
            [255, 128, 0],
            [255 , 255, ],
            [0, 255, 0],
            [0, 255, 255],
            [0, 0, 255],
            [255, 0, 255],
            [128, 128, 128] ][parseInt(colorIndStr)];

        //Averageing the color with white to make it brigher and with black to make it darker.
        if(shadeStr === "2"){
            color = [color[0]/2 + 128, color[1]/2 + 128, color[2]/2 + 128];
        }
        else if(shadeStr === "1"){
            color = [color[0]/2, color[1]/2, color[2]/2];
        }

        return color;
    }

    function combinePossibilities(schedule, courses){
        var newPossibilities = []
        for(let i = 0; i < courses.length; i++){
            
            //If the current coutse forms a valid schedule,
            //add that schedule to newPossibilities
            if(scheduleIsValid(schedule, courses[i])){

                var newPossibility = [];
                for(let j = 0; j < schedule.length; j++){
                    newPossibility.push(schedule[j].copy());
                }
                newPossibility.push(courses[i].copy());

                newPossibilities.push(newPossibility);
            }
        }

        return newPossibilities;
    }

    function scheduleIsValid(schedule, newCourse){
        for(let i = 0; i < schedule.length; i++){
            if(! schedule[i].collides(newCourse)){
                return false;
            }
        }
        return true;
    }

    function daysOverlap(days1, days2){
        for(let i = 0; i < days1.length; i++){
            if (days2.includes( days1.charAt(i) ) ){
                return true;
            }
        }

        return false;
    }

    // Function to download data to a file
    //Thanks Stack Overflow: https://stackoverflow.com/questions/13405129/javascript-create-and-save-file    
    function download(data, filename, type) {
        var file = new Blob([data], {type: type});
        if (window.navigator.msSaveOrOpenBlob) // IE10+
            window.navigator.msSaveOrOpenBlob(file, filename);
        else { // Others
            var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function() {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);  
            }, 0); 
        }
    }
    
    function drawSchedule(schedule){
        var canvas = document.getElementById("MainCanvas");

        var width = canvas.width;
        var height = width;
    }

    function drawCourse(course){

    }

</script>

</html>
