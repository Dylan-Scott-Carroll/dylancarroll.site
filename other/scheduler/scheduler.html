<!--
---
permalink: /other/scheduler
---
-->

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" media="screen and (min-width: 901px)" href="../../CSS/desktop.css" />
    <link rel="stylesheet" media="screen and (max-width: 900px)" href="../../CSS/mobile.css" />
    
    <link rel="stylesheet" href="../../CSS/style.css">

    <style>
        input.HourBox {width: 24pt;}
        input.MinuteBox {width: 24pt;}

        div.border {color: #78CCAD; border-style: solid; border-width: 1pt; border-radius: 6pt;}

        h3 {white-space: nowrap;}

        input.act[type=button] {background-color: lightgray; stroke: none; padding: 10pt 10pt; 
            margin-left: auto; margin-right: auto; font-size: 15pt; color: #505050; 
            font-family: 'Calibri', 'Candara', 'Segoe', "Segoe UI";}

        .inline {display: inline-block;}
    </style>

</head>

<body>


<table id="MainTable">
    
    <tr id="MobileTitleRow">
        <td></td>

        <td id="MobileTitlecolumn">
            <a class="TitleLink" href="https://www.dylancarroll.net">Dylan Carroll</a>
        </td>
    </tr>
    <tr id = "MobileTitleDiv"></tr>


    <tr id="TopBarRow">
        
        <td id="DesktopTitleColumn">
            <a class="TitleLink" href="https://www.dylancarroll.net">Dylan Carroll</a>
        </td>
        <td id="TitleDivColumn" > <div id="TitleDiv"></div> </td>
        
        
        <td>
            <table id="NavTable">
                <tr>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/about">About</a></td>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/animation">Animation</a></td>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/programming">Programming</a></td>
                </tr>
                <tr>
                    
                    <td><a class="NavLink" href="https://www.dylancarroll.net/contact">Contact</a></td>
                    <td><a class="NavLink" href="https://www.dylancarroll.net/other">other</a></td>
                </tr>
            </table>

        </td>
    </tr>
    
    <tr><td id = "ContentPad"></td></tr>

    <tr id="BodyRow"> 
        <table id="BodyTable"><tr>
            <td id="BodyEdge"></td>

            <td>
                <div id="BodyDiv">
                    
                    <h1>Scheduler</h1>

                    <h3>What this is:</h3>
                    <p>This application automates the process of selecting a schedule from a list of courses. Given a list of many course sections, it generates a list of all possible schedules from that list, so you can easily select from that list</p>

                    <h3>How to use it:</h3>
                    <p> <b>Step 1:</b> For each class you may want to register for, fill out all of the information for every section of that class  you might want to register for. </p>
                    <p><b>Step 2:</b> Click "Calculate Options" to generate the list of all valid schedules that can be made from those sections. </p>
                    <p> <b>Step 3:</b> Click "Show Next" and "Show Previous" to cylce through that list to find which schedule is your favorite. </p>
                    <p> <b>Step 4:</b> Download the image of your favorite schedules to remember them later.</p>

                    
                    <h3>Things to Note</h3>
                    <li style="font-size: 15pt; color: #505050; font-family: 'Calibri', 'Candara', 'Segoe', 'Segoe UI'">
                        The "Group" box is meant to create groups of classes that satisfy the same purpose. For example, if you have several sections of the same math class that you may register for, you would give them all the same group, so that only one of them can show up in each schedule. 
                    </li>
                    <br>
                    <li style="font-size: 15pt; color: #505050; font-family: 'Calibri', 'Candara', 'Segoe', 'Segoe UI'">
                        The "Mandatory Group" box is for listing groups you need at least one class from. Any schedule without at lest one class from all manditory groups will not be displayed.
                    </li>
                    <br>
                    <li style="font-size: 15pt; color: #505050; font-family: 'Calibri', 'Candara', 'Segoe', 'Segoe UI'">
                        The "CRN" and "Note" boxes are not mandatory.
                    </li>
                    <br>
                    <li style="font-size: 15pt; color: #505050; font-family: 'Calibri', 'Candara', 'Segoe', 'Segoe UI'">
                        This is still somewhat of a work in progress. Please contact me if you encounter any issues.
                    </li>
                    <br>
                    <br>
                    <br>

                    <div class="border settings" >
                        <table style="margin-left: auto; margin-right: auto; line-height: 0pt; border-spacing: 12pt 0pt;"> 
                        <tbody id="settingsTbody">
                            <tr>
                                <td> <h3 style="line-height: 0pt;"> Settings </td>
                            </tr>

                            <tr>
                                <td > <p>Start Time: </p> </td>
                                <td> <input class=StartTime type="time">  </td>
                                    
                                
                                
                                <td> <p>End Time: </p> </td>
                                <td> <input class=EndTime type="time" >  </td>
                            </tr>
                            
                            <tr>
                                <td> <p>Min Courses</p> </td>
                                <td> <input type="number" min=1 value="1" style="width: 48pt"> </td>


                                <td> <p>Max Courses</p> </td>
                                <td> <input type="number" min=1 style="width: 48pt"> </td>

                                    
                            </tr>
                            
                            <tr>
                                <td> <p>Min Credits</p> </td>
                                <td> <input type="number" min=0 style="width: 48pt"> </td>
                                    
                                
                                
                                <td> <p>Max Credits</p> </td>
                                <td> <input type="number" min=0 style="width: 48pt"> </td>
                                
                                
                            </tr>
                        </tbody>
                        </table>

                        <div align=center>
                            <p class="inline" >Mandatory Groups: </p>
                            <div class="inline" style="width: 24pt;"></div>
                            <textarea id="mandatoryGroups" cols=20 rows=3 style="vertical-align:middle; resize: vertical;"></textarea>
                        </div>

                        <br>

                        <div align=center>
                            <input class="inline" type="file" id="saveFile" name="saveFile" onchange="fileSelected()">
                            <input type=button value="Download Save" onclick="downloadSave()">

                        </div>

                        

                        &nbsp;

                    </div>

                    &nbsp;

                    <table  style="width: 100%;">
                        <tbody id="CourseTableBody">
                        <tr><td>
                            <div class="border" style="line-height: 0pt;"> 
                                <div align="center">
                                    <h3 class="inline" style="line-height: 0pt;">Course</h3>

                                    <p class="inline" style="margin-left: 24pt;">Name:</p> <input type="text" style="width: 72pt;">

                                    <p class="inline" style="margin-left: 24pt;">CRN:</p> <input type="number" style="width: 60pt;">
                                </div>
                                
                                
                                <div align="center">
                                    <p class="inline">Credits:</p> <input type="number" min="0" style="width: 36pt;">
                                
                                    <p class="inline" style="margin-left: 24pt;">Shade:</p>
                                    <select>
                                        <option value="0">Medium</option>
                                        <option value ="1">Dark</option>
                                        <option value="2">Light</option>
                                    </select>

                                    <p class="inline" style="margin-left: 24pt;">Color:</p>
                                    <select>
                                        <option value="0">Red</option>
                                        <option value="1">Orange</option>
                                        <option value="2">Yellow</option>
                                        <option value="3">Green</option>
                                        <option value="4">Teal</option>
                                        <option value="5">Blue</option>
                                        <option value="6">Purple</option>
                                        <option value="7">Grey</option>
                                    </select>
                                </div>

                                <div>
                                    <div align="center">
                                        <p class="inline">Start:</p> <input type="time">

                                        <p class="inline" style="margin-left: 12pt;">End:</p> <input type="time">

                                        <input type="text" value="MTWRF" style="width: 40pt; margin-left: 6pt;">
                                    </div>

                                    <div align="center">
                                        <input type="button" value="Add Time Slot" onclick= "addTimeSlot(this)" style="margin-left: 6pt;">
                                        <input type="button" value="Remove Time Slot" onclick= "removeTimeSlot(this)" style="margin-left: 6pt;"> 
                                    </div>

                                    
                                </div>

                                <div align="center">
                                    <p class="inline">Group:</p> <input type="text" style="width: 36pt;">
                                    <p class="inline" style="margin-left: 12pt;">Note:</p> <input class="inline" type="text" style="width: 175pt; margin-left: 12pt;">
                                </div>
                            </div>
                        </td></tr>

                        
                        </tbody>
                    </table>
                    

                    &nbsp;
                    <div align=center style="margin-left: auto; margin-right: auto; display: block;">
                        <input class="act" type="button" onclick="removeCourse()" value="Remove Course">
                        <input class="act" type="button" onclick="copyCourse()" value="Copy Course">
                        <input class="act" type="button" onclick="addCourse()" value="Add Course">
                    </div>
                    
                    &nbsp;

                    <div id = "DisplayDiv">
                        <div align=center style="margin-left: auto; margin-right: auto; display: block;">
                            <input class="act" type="button" onclick="calcOptions()" value="Calculate Options">
                            <input class="act" type="button" onclick="downloadAllImages()" value="Download All Images">
                        </div>

                        <canvas id="MainCanvas" style="width: 100%; color: #505050 1pt; margin-top: 24pt; margin-bottom: 24pt;" height="10px">

                        </canvas>

                        <div align=center style="margin-left: auto; margin-right: auto; display: block;">
                            <input class="act" type="button" onclick="showPrev()" value="Show Previous">
                            <input class="act" type="button" onclick="downloadImage()" value="Download Image">
                            <input class="act" type="button" onclick="showNext()" value="Show Next">
                        </div>


                    </div>

                </div>
            </td>


            <td id="BodyEdge"></td>
        </tr></table>
    </tr>

</table>

</body>

<script>
    var blankCourseElement = `<tr><td>
                            <div class="border" style="line-height: 0pt;"> 
                                <div align="center">
                                    <h3 class="inline" style="line-height: 0pt;">Course</h3>

                                    <p class="inline" style="margin-left: 24pt;">Name:</p> <input type="text" style="width: 72pt;">

                                    <p class="inline" style="margin-left: 24pt;">CRN:</p> <input type="number" style="width: 60pt;">
                                </div>
                                
                                
                                <div align="center">
                                    <p class="inline">Credits:</p> <input type="number" min="0" style="width: 36pt;">
                                
                                    <p class="inline" style="margin-left: 24pt;">Shade:</p>
                                    <select>
                                        <option value="0">Medium</option>
                                        <option value ="1">Dark</option>
                                        <option value="2">Light</option>
                                    </select>

                                    <p class="inline" style="margin-left: 24pt;">Color:</p>
                                    <select>
                                        <option value="0">Red</option>
                                        <option value="1">Orange</option>
                                        <option value="2">Yellow</option>
                                        <option value="3">Green</option>
                                        <option value="4">Teal</option>
                                        <option value="5">Blue</option>
                                        <option value="6">Purple</option>
                                        <option value="7">Grey</option>
                                    </select>
                                </div>

                                <div>
                                    <div align="center">
                                        <p class="inline">Start:</p> <input type="time">

                                        <p class="inline" style="margin-left: 12pt;">End:</p> <input type="time">

                                        <input type="text" value="MTWRF" style="width: 40pt; margin-left: 6pt;">
                                    </div>

                                    <div align="center">
                                        <input type="button" value="Add Time Slot" onclick= "addTimeSlot(this)" style="margin-left: 6pt;">
                                        <input type="button" value="Remove Time Slot" onclick= "removeTimeSlot(this)" style="margin-left: 6pt;"> 
                                    </div>

                                    
                                </div>

                                <div align="center">
                                    <p class="inline">Group:</p> <input type="text" style="width: 36pt;">
                                    <p class="inline" style="margin-left: 12pt;">Note:</p> <input class="inline" type="text" style="width: 175pt; margin-left: 12pt;">
                                </div>
                            </div>
                        </td></tr>`;

    var blankTimeSlot = `<div align="center">
                            <p class="inline">Start:</p> <input type="time">

                            <p class="inline" style="margin-left: 12pt;">End:</p> <input type="time">

                            <input type="text" value="MTWRF" style="width: 40pt; margin-left: 6pt;">
                        </div>`

    //Draw Settings
    const WIDTH = 2000;
    const HEIGHT = 1200;
    const TOP_MARGIN = 0.07;
    const SIDE_MARGIN = 0.1;
    const MAJOR_LINE_WIDTH = 6;
    const MINOR_LINE_WIDTH = 2;
    const DAY_COUNT = 7;

    var weekDayStrings = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    var weekDayChars = ["m", "t", "w", "r", "f", "s", "u"];

    var courseCount = 1;
                    
    var startTime = 0;
    var endTime = 0; 
    var minCredits = 0;
    var maxCredits = 0;
    var minCourses = 0;
    var maxCourses = 0;
    var mandatoryGroups = [];

    var currentOptionViewed = undefined;
    var allSchedules = undefined;


    

    class Course{
        constructor(name, num, crn, group, credits, starts, ends, days,  color, shade, notes){
            this.name = name; 
            this.num = num;
            this.crn = crn; 
            this.group = group; 
            this.credits = credits; 
            this.starts = starts; 
            this.ends = ends; 
            this.days = days;
            this.shade = shade;
            this.color = color;
            this.notes = notes;
        }

        //Checks if two courses' time slots overlap or if they belong to the same group
        collides(other){
            if(this.group === other.group){
                return false;
            }

            for(let i = 0; i < this.starts.length; i++){
                for(let j = 0; j < other.starts.length; j++){
                    
                    if(daysOverlap(this.days[i], other.days[j]) ){
                        //If the two courses overlap
                        if((this.starts[i] >= other.starts[j] && this.starts[i] <= other.ends[j]) 
                        || (other.starts[j] >= this.starts[i] && other.starts[j] <= this.ends[i])){
                            return false;
                        }
                    }
                }
            }

            return true;
        }

        copy(){
            var newStarts = [...this.starts];
            var newEnds = [...this.ends];
            return new Course(this.name, this.num, this.crn, this.group, this.credits, 
                newStarts, newEnds, this.days, this.color, this.shade, this.notes);
        }

    }

    //////////////////////
    // Button Functions //
    //////////////////////

    function fileSelected(){
        var file = document.getElementById("saveFile").files[0];
        var text = file.text();
        text.then(function(text) { populateFields(text) })
    }

    function downloadSave(){
        if(! updateSettings()){
            return null;
        }
        
        var courses = getCourseDatas();
        if(courses === null){
            return null;
        } 

        saveString = ""

        saveString += startTime + ";";
        saveString += endTime + ";";
        saveString += minCourses + ";";
        saveString += maxCourses + ";";
        saveString += minCredits + ";";
        saveString += maxCredits + ";";

        for(let i = 0; i < mandatoryGroups.length; i++){
            if(i != 0){saveString += ":"}
            saveString += mandatoryGroups[i];
        }
        saveString += "\n";


        for(let i = 0; i < courses.length; i++){
            if(i != 0) saveString += "\n"

            var currentCourse = courses[i]

            saveString += currentCourse.crn + ";"; 
            saveString += currentCourse.name + ";"; 
            saveString += currentCourse.credits + ";"; 
            saveString += currentCourse.shade + ";";
            saveString += currentCourse.color + ";";
            
            for(let i = 0; i < currentCourse.starts.length; i++){
                if(i!=0){saveString += ":";}
                saveString += currentCourse.starts[i];
            }
            saveString += ";";

            for(let i = 0; i < currentCourse.ends.length; i++){
                if(i!=0){saveString += ":";}
                saveString += currentCourse.ends[i];
            }
            saveString += ";";

            for(let i = 0; i < currentCourse.days.length; i++){
                if(i!=0){saveString += ":";}
                saveString += currentCourse.days[i];
            }
            saveString += ";";
            
            saveString += currentCourse.group + ";"; 
            saveString += currentCourse.notes;
        }

        download(saveString, "save.txt", "txt")


    }
    
    function addTimeSlot(button){
        var div = button.parentElement;

        var template = document.createElement("template");
        template.innerHTML = blankTimeSlot
        var newTimeSlot = template.content.firstChild;

        div.parentElement.insertBefore(newTimeSlot, div);
    }

    function removeTimeSlot(button){
        var div = button.parentElement.parentElement;

        var children = div.children;

        if(children.length > 2){
            children[children.length-2].remove();
        }
    }

    function removeCourse(){
        if(courseCount>1){
            var courseTableBody = document.getElementById("CourseTableBody");
            var lastCourse = courseTableBody.childNodes[courseTableBody.childNodes.length - 2];

            lastCourse.remove();

            courseCount -= 1;
        }
    }

    function copyCourse(){
        var courseTableBody = document.getElementById("CourseTableBody");
        var lastCourse = courseTableBody.childNodes[courseTableBody.childNodes.length - 2];
        var buttonTR = courseTableBody.childNodes[courseTableBody.childNodes.length - 1];
        
        courseTableBody.insertBefore(lastCourse.cloneNode(true), buttonTR);
    }

    function addCourse(){
        courseCount += 1;

        var template = document.createElement("template");
        template.innerHTML = blankCourseElement;
        
        var newCourseElement = template.content.firstChild;
        
        var courseTableBody = document.getElementById("CourseTableBody");
        var buttonTR = courseTableBody.childNodes[courseTableBody.childNodes.length - 1];

        courseTableBody.insertBefore(newCourseElement, buttonTR);
    }
 
    function calcOptions(){
        if(! updateSettings()){
            return null;
        }
        
        var courses = getCourseDatas();
        if(courses === null){
            return null;
        } 

        //Create a list of lists with a layer for each number of courses
        var layers = new Array();
        for(let i = 0; i < maxCourses; i++){
            layers.push(new Array());
        }

        //Populate the first layer with individual classes
        for(let i = 0; i < courses.length; i++){
            layers[0].push([courses[i].copy() ]);
        }

        for(let i = 1; i < maxCourses; i++){
            var previousList = layers[i-1]
            var currentList = layers[i];

            for(let j = 0; j < previousList.length; j++){
                //Calculate the new posibilites for the current schedule
                var newPossibilities = combinePossibilities(previousList[j], courses);

                //Add all of the newly found posibilites to the current layer
                for(let k = 0; k < newPossibilities.length; k++){
                    if( !scheduleAlreadyInList(newPossibilities[k], currentList) ){
                        currentList.push(newPossibilities[k]);
                    }
                }
            }
        }

        console.log(layers);

        allSchedules = []
        for(let i = minCourses-1; i <= maxCourses-1; i++){
            var layer = layers[i];

            for(let j = 0; j < layer.length; j++){
                var schedule = layer[j];

                var credits = sumCredits(schedule);

                if(credits >= minCredits && credits <= maxCredits){
                    if( scheduleHasMandatory(schedule) ){
                        allSchedules.push(schedule);
                    }
                }
            }
        }

        currentOptionViewed = 0;

        drawSchedule(currentOptionViewed);
    }

    function downloadAllImages(){
        if(allSchedules === undefined){
            alert("You must click calculate options first.")
            return undefined;
        }
        
        for(let i = 0; i < allSchedules.length; i++){
            drawSchedule(i);
            downloadCanvas(i);
        }
    }

    function downloadImage(){
        if(allSchedules === undefined){
            alert("You must click calculate options first.")
            return undefined;
        }

        drawSchedule(currentOptionViewed);
        downloadCanvas(currentOptionViewed);
    }

    function showNext(){
        if(allSchedules === undefined){
            alert("You must click calculate options first.")
            return undefined;
        }

        currentOptionViewed ++;

        if(currentOptionViewed >= allSchedules.length){
            currentOptionViewed = 0;
        }

        drawSchedule(currentOptionViewed);
    }

    function showPrev(){
        if(allSchedules === undefined){
            alert("You must click calculate options first.")
            return undefined;
        }
        
        currentOptionViewed --;

        if(currentOptionViewed < 0){
            currentOptionViewed = allSchedules.length-1;
        }

        drawSchedule(currentOptionViewed);
    }

    ///////////////////
    // Program Logic //
    ///////////////////

    function populateFields(text){
        
        var courseList = text.split("\n");


        //Update Settings Field

        var settings = courseList[0].split(";");
   
        var settingsTbody = document.getElementById("settingsTbody");

        var row1 = settingsTbody.children[1];
        var row2 = settingsTbody.children[2];
        var row3 = settingsTbody.children[3];

        row1.children[1].children[0].value = minsToTime(parseInt(settings[0]));
        row1.children[3].children[0].value = minsToTime(parseInt(settings[1])); 
        row2.children[1].children[0].value = parseInt(settings[2]);
        row2.children[3].children[0].value = parseInt(settings[3]);
        row3.children[1].children[0].value = parseInt(settings[4]);
        row3.children[3].children[0].value = parseInt(settings[5]);

        document.getElementById("mandatoryGroups").value = settings[6].replace(":", "\n");

        //Get to the correct number of courses
        while(courseCount < courseList.length-1){
            addCourse();
        }
        while(courseCount > courseList.length-1){
            removeCourse();
        }
        

        //Loop through and fill in all of the courses
        var courseTableBody = document.getElementById("CourseTableBody");
        var courseTDs = courseTableBody.children;

        for(let i = 0; i < courseList.length-1; i++){
            var currentCourse = courseList[i+1].split(";");
            
            var borderDiv = courseTDs[i].children[0].children[0];

            var div1 = borderDiv.children[0];
            var div2 = borderDiv.children[1];
            var div3 = borderDiv.children[2];
            var div4 = borderDiv.children[3];

            div1.children[2].value = currentCourse[1]; //crn
            div1.children[4].value = currentCourse[0]; //name
            div2.children[1].value = currentCourse[2]; //credits
            div2.children[3].value = currentCourse[3]; //shade
            div2.children[5].value = currentCourse[4]; //color
            
            
            var starts = currentCourse[5].split(":"); //starts
            var ends = currentCourse[6].split(":"); //ends
            var days = currentCourse[7].split(":"); //days

            //Get to the correct number of time slots
            var addButton = div3.children[div3.children.length-1].firstChild;
            while(div3.children.length-1 < starts.length){
                addTimeSlot(addButton);
            }
            while(div3.children.length-1 > starts.length){
                removeTimeSlot(addButton);
            }

            for(let i = 0; i < div3.children.length-1; i++){
                var currentDiv = div3.children[i];


                currentDiv.children[1].value = minsToTime(starts[i]); //start
                currentDiv.children[3].value = minsToTime(ends[i]); //end
                currentDiv.children[4].value = days[i]; //day
            }
            
            div4.children[1].value = currentCourse[8]; //group
            div4.children[3].value = currentCourse[9]; //notes

        }
    }

    function updateSettings(){
        var settingsTbody = document.getElementById("settingsTbody");

        var row1 = settingsTbody.children[1];
        var row2 = settingsTbody.children[2];
        var row3 = settingsTbody.children[3];

        var newStart = row1.children[1].children[0].value;
        var newEnd = row1.children[3].children[0].value;
        var newMinCourses = row2.children[1].children[0].value;
        var newMaxCourses = row2.children[3].children[0].value;
        var newMinCredits = row3.children[1].children[0].value;
        var newMaxCredits = row3.children[3].children[0].value;

        mandatoryGroups = document.getElementById("mandatoryGroups").value.split("\n");

        console.log(mandatoryGroups);

        if(! validateSettings(newStart, newEnd, newMinCourses, newMaxCourses, newMinCredits, newMaxCredits) ){
            return false;
        }
        else{
            startTime = timeToMins(newStart);
            endTime = timeToMins(newEnd);
            minCourses = parseInt(newMinCourses);
            maxCourses = parseInt(newMaxCourses);
            minCredits = parseInt(newMinCredits);
            maxCredits = parseInt(newMaxCredits);

            return true;
        }
        
    }

    //TODO: Check the bounds of the values
    function validateSettings(start, end, minCourses, maxCourses, minCredits, maxCredits){
        if(start === ""){
            alert("Start Time can't be empty");
            return false;
        }
        else if(end === ""){
            alert("End time can't be empty");
            return false;
        }
        else if(minCourses === ""){
            alert("Min courses can't be empty");
            return false;
        }
        else if(maxCourses === ""){
            alert("Max courses can't be empty");
            return false;
        }
        else if(minCredits === ""){
            alert("Min Credits can't be empty");
            return false;
        }
        else if(maxCredits === ""){
            alert("Max Credits can't be empty");
            return false;
        }
        else{
            return true;
        }
    }

    function validateCourseForm(course, name, crn, credits, starts, ends){
        
        for(let i = 0; i < starts.length; i++){
            
            if(starts[i] === ""){
                alert("Course " + course + " start time can't be empty");
                return false;
            }
            
            if(ends[i] === ""){
                alert("Course " + course + " end time can't be empty");
                return false;
            }
        }
        
        if(name === ""){
            alert("Course " + course + " name can't be empty");
            return false;
        }
        else if(crn === ""){
            alert("Course " + course + " CRN can't be empty");
            return false;
        }
        else if(credits === ""){
            alert("Course " + course + " credits can't be empty");
            return false;
        }
        else{
            return true;
        }

        
    }

    function getCourseDatas(){
        var courseTableBody = document.getElementById("CourseTableBody");
        var courseTDs = courseTableBody.children;

        var courses = []

        for(let i = 0; i < courseTDs.length; i++){
            var borderDiv = courseTDs[i].children[0].children[0];

            var div1 = borderDiv.children[0];
            var div2 = borderDiv.children[1];
            var div3 = borderDiv.children[2];
            var div4 = borderDiv.children[3];

            var name = div1.children[2].value;
            var crn = div1.children[4].value;
            var credits = div2.children[1].value;
            var shade = div2.children[3].value;
            var color = div2.children[5].value;
            
            
            var rawStarts = [];
            var rawEnds = [];
            var days = [];

            for(let i = 0; i < div3.children.length-1; i++){
                var currentDiv = div3.children[i];

                rawStarts.push(currentDiv.children[1].value);
                rawEnds.push(currentDiv.children[3].value);
                days.push(currentDiv.children[4].value.toLowerCase());
            }
            
            
            var group = div4.children[1].value;
            var notes = div4.children[3].value;


            if(! validateCourseForm(i+1, name, crn, credits, rawStarts, rawEnds)){
                return null;
            }

            var starts = [];
            var ends = [];

            for(let i = 0; i < rawStarts.length; i++){
                starts.push(timeToMins(rawStarts[i]));
                ends.push(timeToMins(rawEnds[i]));
            }

            if(group == ""){
                group = i.toString();
            }
            
            var newCourse = new Course(name, i, crn, group, parseInt(credits), starts, ends, days, color, shade, notes);
            courses.push( newCourse );

        }

        return courses;
    }

    function timeToMins(time){
        var splitTime = time.split(":");
        var hour = splitTime[0];
        var minute = splitTime[1];
        return parseInt(hour)*60 + parseInt(minute);
    }

    function minsToTime(mins){
        var hours = Math.floor(mins/60);
        var minutes = mins - (hours*60);
        var minutesString = minutes.toString();
        if(minutesString.length ==1 )(minutesString = 0 + minutesString)
        
        var hoursString = hours.toString()
        if(hoursString.length ==1 )(hoursString = 0 + hoursString)

        return hoursString + ":" + minutesString; 
    }

    function minsToPrettyTime(mins){
        var hours = Math.floor(mins/60);
        var minutes = mins - (hours*60);
        
        var AMPM = "";
        if(hours > 12){
            hours -= 12;
            AMPM = "PM"
        }
        else{
            AMPM = "AM"
        }

        var minutesString = minutes.toString();
        if(minutesString.length ==1 )(minutesString = 0 + minutesString)
        
        var hoursString = hours.toString()
        if(hoursString.length ==1 )(hoursString = " " + hoursString)

        return hoursString + ":" + minutesString + " " + AMPM; 
    }

    function colStrToRGB(shadeStr, colorIndStr){
        //Select the correct color from this list
        var color = [ [255, 0, 0],
            [255, 128, 0],
            [255 , 255, ],
            [0, 255, 0],
            [0, 255, 255],
            [0, 0, 255],
            [255, 0, 255],
            [128, 128, 128] ][parseInt(colorIndStr)];

        //Averageing the color with white to make it brigher and with black to make it darker.
        if(shadeStr === "2"){
            color = [color[0]/2 + 128, color[1]/2 + 128, color[2]/2 + 128];
        }
        else if(shadeStr === "1"){
            color = [color[0]/2, color[1]/2, color[2]/2];
        }

        return color;
    }

    function combinePossibilities(schedule, courses){
        var newPossibilities = []
        for(let i = 0; i < courses.length; i++){
            
            //If the current coutse forms a valid schedule,
            //add that schedule to newPossibilities
            
            var isValid = scheduleIsValid(schedule, courses[i]);

            if(isValid){

                var newPossibility = [];
                for(let j = 0; j < schedule.length; j++){
                    newPossibility.push(schedule[j].copy());
                }
                newPossibility.push(courses[i].copy());

                newPossibility.sort(function (a, b) {
                return a.num - b.num;
                });

                newPossibilities.push(newPossibility);

                
            }
        }

        return newPossibilities;
    }

    function scheduleAlreadyInList(schedule, list){
        
        var IDString = scheduleToIDString(schedule);
        for(let i = 0; i < list.length; i++){
            if(scheduleToIDString(list[i]) == IDString ){
                return true;
            }
        }
        return false;
    }

    function scheduleToIDString(schedule){
        var string = "";
        for(let i = 0; i < schedule.length; i++){
            if(i!=0){string += " ";}
            string += schedule[i].num;
        }

        return string;
    }

    function scheduleHasMandatory(schedule){
        for(let i = 0; i < mandatoryGroups.length; i++){
            var hasCurentGroup = false;

            for(let j = 0; j < schedule.length; j++){
                if(schedule[j].group == mandatoryGroups[i]){
                    hasCurentGroup = true;
                }
            }

            if(!hasCurentGroup){
                return false;
            }
        }

        return true;
    }

    function scheduleIsValid(schedule, newCourse){
        
        for(let i = 0; i < schedule.length; i++){
            if(! schedule[i].collides(newCourse)){
                return false;
            }
        }
        return true;
    }

    function schedulesEqual(s1, s2){
        var list1 = Array();
        for(let i = 0; i < s1.length; i++){
            list1.push(s1[i].num)
        }
    }

    function sumCredits(schedule){
        var sum = 0;
        for(let i = 0; i < schedule.length; i++){
            sum += schedule[i].credits;
        }
        return sum;
    }
    
    function daysOverlap(days1, days2){
        for(let i = 0; i < days1.length; i++){
            if (days2.toLowerCase().includes( days1.toLowerCase().charAt(i) ) ){
                return true;
            }
        }

        return false;
    }

    // Function to download data to a file
    //Thanks Stack Overflow: https://stackoverflow.com/questions/13405129/javascript-create-and-save-file    
    function download(data, filename, type) {
        var file = new Blob([data], {type: type});
        if (window.navigator.msSaveOrOpenBlob) // IE10+
            window.navigator.msSaveOrOpenBlob(file, filename);
        else { // Others
            var a = document.createElement("a"),
                    url = URL.createObjectURL(file);
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            setTimeout(function() {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);  
            }, 0); 
        }
    }
    
    //TODO: Add information about the schedule in the top bar
    function drawSchedule(schedule){
        var canvas = document.getElementById("MainCanvas");
        var ctx = canvas.getContext("2d");

        canvas.width = WIDTH;
        canvas.height = HEIGHT;

        var dayWidth = (WIDTH*(1-SIDE_MARGIN))/DAY_COUNT;
        var hourCount = (endTime - startTime)/60
        var hourHeight = (HEIGHT*(1-TOP_MARGIN)) / hourCount;

        var topMarginOffset = HEIGHT*TOP_MARGIN
        var sideMarginOffset = WIDTH*SIDE_MARGIN

        
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, WIDTH, HEIGHT);
        
        ctx.lineWidth = MAJOR_LINE_WIDTH;
        ctx.fillStyle = "#000000";
        
        ctx.beginPath();
        ctx.moveTo(sideMarginOffset , 0);
        ctx.lineTo(sideMarginOffset, HEIGHT);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0 , topMarginOffset);
        ctx.lineTo(WIDTH, topMarginOffset);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(0 , 0);
        ctx.lineTo(WIDTH , 0);
        ctx.lineTo(WIDTH , HEIGHT);
        ctx.lineTo(0 , HEIGHT);
        ctx.lineTo(0 , 0);
        ctx.stroke();

        var fontSize = Math.floor(topMarginOffset / 2.5);
        ctx.font = fontSize + "px Arial";

        ctx.fillText("Option " + (schedule+1), fontSize*0.5, fontSize*1.2)
        ctx.fillText(sumCredits(allSchedules[schedule]) + " credits", fontSize*0.5, fontSize*2.2)


        var fontSize = Math.floor(topMarginOffset / 2);
        ctx.font = fontSize + "px Arial";

        for(let day = 1; day <= DAY_COUNT; day++){
            let xPos = sideMarginOffset + dayWidth*day;

            ctx.fillText(weekDayStrings[day-1], xPos-dayWidth*0.95, topMarginOffset*0.70)

            ctx.beginPath();
            ctx.moveTo(xPos , 0);
            ctx.lineTo(xPos, HEIGHT);
            ctx.stroke();
        }

        var fontSize = Math.floor(hourHeight / 5) + "px";
        ctx.font = fontSize + " Arial";

        ctx.lineWidth = MINOR_LINE_WIDTH;
        for(let hour = 1; hour < hourCount+1; hour++){
            let yPos = topMarginOffset + hourHeight*hour;

            
            var time = minsToPrettyTime(startTime + (hour-1)*60);
            ctx.fillText(time, sideMarginOffset*0.38, yPos-(hourHeight*0.75) );

            ctx.beginPath();
            ctx.moveTo(0 , yPos);
            ctx.lineTo(WIDTH, yPos);
            ctx.stroke();
        }

        for(let i = 0; i < allSchedules[schedule].length; i++){
            drawCourse(allSchedules[schedule][i], ctx, dayWidth, hourHeight, sideMarginOffset, topMarginOffset)
        }

    }

    function drawCourse(course, ctx, dayWidth, hourHeight, sideMarginOffset, topMarginOffset){
        
        for(let i = 0; i < course.days.length; i++){
            for(let day = 0; day < DAY_COUNT; day++){
                var onDay = daysOverlap(course.days[i], weekDayChars[day])

                if(onDay){
                    var xPos = sideMarginOffset + dayWidth*day;
                    var yPos = topMarginOffset + (hourHeight*(course.starts[i]-startTime)/60);

                    var color = colStrToRGB(course.shade, course.color);

                    ctx.fillStyle = `rgb(
                        ${color[0]},
                        ${color[1]},
                        ${color[2]})`


                    var duration = (course.ends[i] - course.starts[i])/60
                    ctx.fillRect(xPos + MAJOR_LINE_WIDTH/2, yPos, dayWidth - MAJOR_LINE_WIDTH, duration*hourHeight);

                    ctx.fillStyle = findTextColor(color);

                    var fontSize = Math.floor(hourHeight /5);
                    ctx.font = fontSize + "px Arial";
                    
                    var notes = course.notes;
                    var notes2 = ""
                    if(notes.length > 17){
                        let temp = notes;
                        notes = temp.slice(0, 17);
                        notes2 = temp.slice(15, temp.length);
                    }

                    ctx.fillText(course.name, xPos + fontSize/2, yPos + fontSize*1.1);
                    ctx.fillText(course.crn + " - " + course.credits, xPos + fontSize/2, yPos + fontSize*2.1);
                    ctx.fillText(notes, xPos + fontSize/2, yPos + fontSize*3.1);
                    ctx.fillText(notes2, xPos + fontSize/2, yPos + fontSize*4.1);
                }
            }
        }
    }

    function findTextColor(color){
        if( (0.299*color[0] + 0.587*color[1] + 0.114*color[2]) > 128 ){
            return "#000000";
        }
        else{
            return "#E0E0E0";
        }
    }

    function downloadCanvas(i){
        
        
        var canvas = document.getElementById("MainCanvas");
        var link = document.createElement('a');
        link.download = "Option_" + (i+1) +  '.png';
        link.href = canvas.toDataURL();
        link.click();

        link.remove();
    }

</script>

</html>
